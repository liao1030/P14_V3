flowchart TD
    A[GetMidADC 函嫡{用] --> B[B分配w<br/>sampleCount * sizeof uint16_t]
    B --> B1{w分配成功?}
    B1 -->|否| B2[返回e`值 0]
    B1 -->|是| C[凋C<br/>midCount ≤ sampleCount]
    C --> D[配置 ADC 通道<br/>ADC_RegularChannelConfig]
    D --> E[_始Bm取友h<br/>i = 0 to sampleCount]
    
    E --> F[ ADC DQ<br/>ADC_SoftwareStartConvCmd]
    F --> G[等待DQ完成<br/>while !ADC_FLAG_EOC]
    G --> H[x取 ADC 值<br/>ADC_GetConversionValue]
    H --> I[存入取雨列<br/>samples(i)]
    I --> J[微延t 10us<br/>_保取臃定]
    J --> K{所有取油瓿?}
    K -->|否| E
    K -->|是| L[馀菖判蜓菟惴]
    
    L --> M[外友h i = 0 to sampleCount-1]
    M --> N[友h j = 0 to sampleCount-i-1]
    N --> O{samples(j) > samples(j+1)?}
    O -->|是| P[交Q位置<br/>temp = samples(j)<br/>samples(j) = samples(j+1)<br/>samples(j+1) = temp]
    O -->|否| Q
    P --> Q{友h完成?}
    Q -->|否| N
    Q -->|是| R{外友h完成?}
    R -->|否| M
    R -->|是| S[算中g值]
    
    S --> T[startIndex = (sampleCount - midCount) / 2]
    T --> U[endIndex = startIndex + midCount]
    U --> V[算中g值和<br/>sum = 0]
    V --> W[累加中g值<br/>for i = startIndex to endIndex]
    W --> X[sum += samples(i)]
    X --> Y{累加完成?}
    Y -->|否| W
    Y -->|是| Z[算平均值<br/>average = sum / midCount]
    Z --> AA[放w<br/>free(samples)]
    AA --> BB[返回平均值]
    
    style A fill:#e8f5e8
    style L fill:#fff3e0
    style BB fill:#c8e6c9