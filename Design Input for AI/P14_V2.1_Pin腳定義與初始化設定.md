
# P14_V2.1 Pin腳定義與初始化設定

## 1. CH32V203 (MCU) Pin 腳連接

| Pin 編號 | Pin 名稱            | Net Name  | 功能                                       | 初始化設定                       |
|:--------:|:--------------------|:---------:|:-------------------------------------------|:---------------------------------|
| 2        | PB6/U2DM/SCL/TIM4_CH1 | Red      | 紅色LED控制 (High Enable)                   | Digital Output Low              |
| 3        | PB7/U2DP/SDA/TIM4_CH2 | Green    | 綠色LED控制 (High Enable)                   | Digital Output Low              |
| 10       | PA1/ADC1             | TM_IN     | 測溫電壓輸入                                | Digital Input Floating          |
| 11       | PA2/ADC2/OP2O0       | MCU_TX    | UART 2 Tx (與CH582F通訊)                    | USART2 TX                       |
| 12       | PA3/ADC3/OP1O0       | MCU_RX    | UART 2 Rx (與CH582F通訊)                    | USART2 RX，上拉輸入(GPIO_Mode_IPU) |
| 13       | PA6/ADC6/OP1N1       | T1_OUT    | 測量GAV試片T1電極電壓(HCT補償)             | Digital Input Floating          |
| 14       | PB0/ADC8/OP1P1       | T3_ADC    | 測量GAV試片T3電極電壓(血飽終點偵測)         | Digital Input Floating          |
| 15       | PA4/ADC4/OP2O1       | GLU_OUT   | 測量W電極電流(生化反應結果)                 | Digital Input Floating          |
| 17       | PA7/ADC7/OP2P1       | EV_WE     | W電極電壓 (與OP非反向端連接)                 | Digital Input Floating          |
| 18       | PB10/OP2N0           | KEY_2     | 按鍵輸入(生產測試用)                        | Digital Input Floating，上拉輸入(GPIO_Mode_IPU) |
| 19       | PB11/OP1N0           | KEY_1     | 按鍵輸入(生產測試用)                        | Digital Input Floating，上拉輸入(GPIO_Mode_IPU) |
| 20       | PB1/ADC9/OP1O1/PB12/TIM1_BKIN | Battery | 電池電壓偵測 (低電量檢測)                   | Digital Input Floating          |
| 23       | PB15/OP1P0/TIM1_CH3N | WE_ENABLE | W電極電壓PWM控制                            | Digital Output High             |
| 24       | PA8/TIM1_CH1         | T1_ENABLE | T1電極量測致能控制 (Low Enable)              | Digital Output High             |

## 2. CH582F (BLE) Pin 腳連接

| Pin 編號 | Pin 名稱                   | Net Name            | 功能                                      | 初始化設定                       |
|:--------:|:----------------------------|:-------------------:|:----------------------------------------|:---------------------------------|
| 6        | PA8/RXD1/AIN12               | BLE_RX              | UART 1 Rx (與CH32V203通訊)               |                                 |
| 7        | PA9/TMR0/TXD1/AIN13          | BLE_TX              | UART 1 Tx (與CH32V203通訊)               |                                 |
| 12       | PB11/UD+/TMR2_               | Strip_Detect_3      | 試片插入偵測(Falling Edge Interrupt)    | Digital Input Floating，上拉輸入(GPIO_Mode_IPU) |
| 13       | PB10/UD-/TMR1_               | T3_IN_SEL           | T3電極量測致能控制 (High Enable)         | Digital Output Low              |
| 14       | PB7/TXD0/PWM9                | D-_UART_TX_MCU      | UART 0 Tx (與外部設備1通訊)              | USART 0 TX                      |
| 15       | PB4/RXD0/PWM7                | D+_UART_RX_MCU      | UART 0 Rx (與外部設備1通訊)              | USART 0 RX                      |
| 23       | PA4/RXD3/AIN0                | D-_UART_RX_MCU      | UART 3 Rx (與外部設備2通訊)              | USART 3 TX                      |
| 24       | PA5/TXD3/AIN1                | D+_UART_TX_MCU      | UART 3 Tx (與外部設備2通訊)              | USART 3 RX                      |
| 25       | PA15/MISO/RXD0_/AIN5         | Strip_Detect_5      | 試片插入偵測(Falling Edge Interrupt)    | Digital Input Floating，上拉輸入(GPIO_Mode_IPU) |
| 26       | PA14/MOSI/TXD0_/AIN4         | V2P5_ENABLE         | 供電給CH32V203致能控制 (High Enable)     | Digital Output High             |
| 27       | PA13/SCK0/PWM5/AIN3          | V_back_C            | 外部UART設備Rx Level Shift電源選擇控制    | Digital Output Low              |
| 28       | PA12/SCS/PWM4/AIN2           | VBUS_Get            | 量測外部設備是否供電                     | Digital Input Floating          |

## 3. 系統初始化清單

### 3.1 CH32V203 (MCU) 初始化

| 順序 | 初始化項目     | 設定參數                                             | 說明                         |
|:----:|:---------------|:----------------------------------------------------|:------------------------------|
| 1    | 系統時鐘初始化 | HSI設為系統時鐘源，運行於16MHz                         |                              |
| 2    | UART 2初始化   | 波特率115200、資料位元8、停止位元1、無同位檢查         | 與CH582F (BLE)通訊            |

### 3.2 CH582F (BLE) 初始化

| 順序 | 初始化項目      | 設定參數                                             | 說明                         |
|:----:|:----------------|:----------------------------------------------------|:------------------------------|
| 1    | 系統時鐘初始化  | 使用PLL作為時鐘源，系統時鐘設定為60MHz               |                              |
| 2    | UART 1初始化    | 波特率115200、資料位元8、停止位元1、無同位檢查        | 與CH32V203 (MCU)通訊           |
|      | UART 0初始化    | 波特率115200、資料位元8、停止位元1、無同位檢查        | 與外部設備1通訊               |
|      | UART 3初始化    | 波特率115200、資料位元8、停止位元1、無同位檢查        | 與外部設備2通訊               |
